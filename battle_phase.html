<!DOCTYPE html>
<html>
  <head>
	<meta charset="UTF-8">
    <style type="text/css">
		div#player1 {
			border:2px solid;
			border-radius:25px;
			position: absolute;
			background: grey;
			width: 90px;
			height: 150px;
		}
		div#player1_cannon {
			background: black;
			height: 120px;
			width: 30px;
		}
			  
		div#player1_turret {
			background: black;
			height: 30px;
			width: 30px;
			margin: 25px auto;
			z-index: 3;
		}
		
		div#laser {
			position: absolute;
			visibility: none;
			left: 0;
			top: 0;
			width: 10px;
			height: 10px;
			background-color: red;
      }
    </style>
    <script src="tanks/tanks/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript">
	var mouse_x; //mouse x coordinates
	var mouse_y; //mouse y coordinates
	var tank_x = 0; //tank x coordinates
	var tank_y = 0; // tank y coordinates
	var time_out = setTimeout(turret_direction, 25); //begin updating current turret location
	var turret_degree = 0; // direction of turret in degrees
	var player1_angle = 0; // relative angle of mouse to tank
	
	var angle = 0;
	//current mouse position
	$(document).mousemove(function(e){
      mouse_x = e.pageX;
	  mouse_y = e.pageY;
	});
	
	//current tank position
	function tank_pos(){
		tank_x = $( "#player1" ).position().left + 45; //tank x coordinates
		tank_y = $( "#player1" ).position().top + 75; // tank y coordinates
	}
	
	// update the turret position
	function turret_direction() {
		tank_pos();
		var deltaY = (mouse_x - tank_x); //adjust origin of compass to match turret
		var deltaX = (mouse_y - tank_y);
		player1_angle = (-1 * (Math.round(Math.atan2(deltaY, deltaX)*180/Math.PI)) + 360) % 360; //*-1
	    turret_degree = (turret_degree + 360) % 360;

		if (((player1_angle) != turret_degree)){
		    var difference = (player1_angle - turret_degree + 360) % 360;
			if (difference < 180){
				turret_degree = (turret_degree + 1) % 360; //rotate clockwise
			} else if (difference > 180) {
				turret_degree = (turret_degree - 1) % 360; //rotate counter clockwise
			}
		}
		$("#player1_turret") // change turret position to turret_degree
			.css({
				"-moz-transform" : "rotate(" + turret_degree + "deg)"
				});
		time_out = setTimeout(turret_direction, 25); // repeat myself
		$("#test").html("mouse angle: " + player1_angle + ", turret angle:" + turret_degree);
	}
	
	$(function(){ //fire cannon with mouse
		$( document ).mousedown( function(event){
			if(player1_angle == turret_degree){ //only fire when cannon is in position
				$("#laser").offset({left: tank_x, top: tank_y - 35});
                $("#laser").css("display", "block").animate({top: mouse_y, left: mouse_x}, 500);
			}
		});
	});
	
	//tank movement
      $(function(){
        $( document ).keydown( function( event ){
          var keyCode = event.keyCode || event.which;
          var keyMap = { left: 65, up: 87, right: 68, down: 83}
          switch ( keyCode ) {
            case keyMap.left:
              $( "#player1" ).stop().animate({
                left: '-=40'
              }, 100 );
            break;
			
			case keyMap.right:
              $( "#player1" ).stop().animate({
                left: '+=40'
              }, 100 );
            break;
 
            case keyMap.up:
              $( "#player1" ).stop().animate({
                top: '-=40'
              }, 100 );
            break;
			
			case keyMap.down:
              $( "#player1" ).stop().animate({
                top: '+=40'
              }, 100 );
            break;
			
			case keyMap.space:
				var tankleft = $("#player1").position().left;
                var tanktop = $("#player1").position().top; // LOL tanktop
                var targetleft = 1000;
                var targettop = 1000;
                $("#laser").offset({left:tankleft + 50, top: tanktop + 50});
                $("#laser").animate({visibility: 'visible', top: targettop, left: targetleft}, 500);
            break;
			}
		});
	});
    </script>
  </head>
  <body>
	<div id="player1" >
		<div id="player1_turret">
			<div id="player1_cannon"></div>
		</div>
	</div>
	<div id="laser"></div>
	<p id="test"></p>
  </body>
  
</html>
